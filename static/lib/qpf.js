(function(factory){if(typeof define!=="undefined"&&define["amd"]){define(["exports","knockout","$","_"],factory)}else{factory(window["qpf"]={},ko,$,_)}})(function(_exports,ko,$,_){var requirejs,require,define;(function(undef){var main,req,makeMap,handlers,defined={},waiting={},config={},defining={},hasOwn=Object.prototype.hasOwnProperty,aps=[].slice;function hasProp(obj,prop){return hasOwn.call(obj,prop)}function normalize(name,baseName){var nameParts,nameSegment,mapValue,foundMap,foundI,foundStarMap,starI,i,j,part,baseParts=baseName&&baseName.split("/"),map=config.map,starMap=map&&map["*"]||{};if(name&&name.charAt(0)==="."){if(baseName){baseParts=baseParts.slice(0,baseParts.length-1);name=baseParts.concat(name.split("/"));for(i=0;i<name.length;i+=1){part=name[i];if(part==="."){name.splice(i,1);i-=1}else if(part===".."){if(i===1&&(name[2]===".."||name[0]==="..")){break}else if(i>0){name.splice(i-1,2);i-=2}}}name=name.join("/")}else if(name.indexOf("./")===0){name=name.substring(2)}}if((baseParts||starMap)&&map){nameParts=name.split("/");for(i=nameParts.length;i>0;i-=1){nameSegment=nameParts.slice(0,i).join("/");if(baseParts){for(j=baseParts.length;j>0;j-=1){mapValue=map[baseParts.slice(0,j).join("/")];if(mapValue){mapValue=mapValue[nameSegment];if(mapValue){foundMap=mapValue;foundI=i;break}}}}if(foundMap){break}if(!foundStarMap&&starMap&&starMap[nameSegment]){foundStarMap=starMap[nameSegment];starI=i}}if(!foundMap&&foundStarMap){foundMap=foundStarMap;foundI=starI}if(foundMap){nameParts.splice(0,foundI,foundMap);name=nameParts.join("/")}}return name}function makeRequire(relName,forceSync){return function(){return req.apply(undef,aps.call(arguments,0).concat([relName,forceSync]))}}function makeNormalize(relName){return function(name){return normalize(name,relName)}}function makeLoad(depName){return function(value){defined[depName]=value}}function callDep(name){if(hasProp(waiting,name)){var args=waiting[name];delete waiting[name];defining[name]=true;main.apply(undef,args)}if(!hasProp(defined,name)&&!hasProp(defining,name)){throw new Error("No "+name)}return defined[name]}function splitPrefix(name){var prefix,index=name?name.indexOf("!"):-1;if(index>-1){prefix=name.substring(0,index);name=name.substring(index+1,name.length)}return[prefix,name]}makeMap=function(name,relName){var plugin,parts=splitPrefix(name),prefix=parts[0];name=parts[1];if(prefix){prefix=normalize(prefix,relName);plugin=callDep(prefix)}if(prefix){if(plugin&&plugin.normalize){name=plugin.normalize(name,makeNormalize(relName))}else{name=normalize(name,relName)}}else{name=normalize(name,relName);parts=splitPrefix(name);prefix=parts[0];name=parts[1];if(prefix){plugin=callDep(prefix)}}return{f:prefix?prefix+"!"+name:name,n:name,pr:prefix,p:plugin}};function makeConfig(name){return function(){return config&&config.config&&config.config[name]||{}}}handlers={require:function(name){return makeRequire(name)},exports:function(name){var e=defined[name];if(typeof e!=="undefined"){return e}else{return defined[name]={}}},module:function(name){return{id:name,uri:"",exports:defined[name],config:makeConfig(name)}}};main=function(name,deps,callback,relName){var cjsModule,depName,ret,map,i,args=[],usingExports;relName=relName||name;if(typeof callback==="function"){deps=!deps.length&&callback.length?["require","exports","module"]:deps;for(i=0;i<deps.length;i+=1){map=makeMap(deps[i],relName);depName=map.f;if(depName==="require"){args[i]=handlers.require(name)}else if(depName==="exports"){args[i]=handlers.exports(name);usingExports=true}else if(depName==="module"){cjsModule=args[i]=handlers.module(name)}else if(hasProp(defined,depName)||hasProp(waiting,depName)||hasProp(defining,depName)){args[i]=callDep(depName)}else if(map.p){map.p.load(map.n,makeRequire(relName,true),makeLoad(depName),{});args[i]=defined[depName]}else{throw new Error(name+" missing "+depName)}}ret=callback.apply(defined[name],args);if(name){if(cjsModule&&cjsModule.exports!==undef&&cjsModule.exports!==defined[name]){defined[name]=cjsModule.exports}else if(ret!==undef||!usingExports){defined[name]=ret}}}else if(name){defined[name]=callback}};requirejs=require=req=function(deps,callback,relName,forceSync,alt){if(typeof deps==="string"){if(handlers[deps]){return handlers[deps](callback)}return callDep(makeMap(deps,callback).f)}else if(!deps.splice){config=deps;if(callback.splice){deps=callback;callback=relName;relName=null}else{deps=undef}}callback=callback||function(){};if(typeof relName==="function"){relName=forceSync;forceSync=alt}if(forceSync){main(undef,deps,callback,relName)}else{setTimeout(function(){main(undef,deps,callback,relName)},4)}return req};req.config=function(cfg){config=cfg;if(config.deps){req(config.deps,config.callback)}return req};define=function(name,deps,callback){if(!deps.splice){callback=deps;deps=[]}if(!hasProp(defined,name)&&!hasProp(waiting,name)){waiting[name]=[name,deps,callback]}};define.amd={jQuery:true}})();var _define=define;_define("$",[],function(){return $});_define("knockout",[],function(){return ko});_define("_",[],function(){return _});define("core/xmlparser",["require","exports","module","_"],function(require,exports,module){var _=require("_");var parse=function(xmlString,dom){if(typeof xmlString=="string"){var xml=parseXML(xmlString)}else{var xml=xmlString}if(xml){var rootDomNode=dom||document.createElement("div");convert(xml,rootDomNode);return rootDomNode}};function parseXML(xmlString){var xml,parser;try{if(window.DOMParser){xml=(new DOMParser).parseFromString(xmlString,"text/xml")}else{xml=new ActiveXObject("Microsoft.XMLDOM");xml.async="false";xml.loadXML(xmlString)}return xml}catch(e){console.error("Invalid XML:"+xmlString)}}var customParsers={};function provideParser(componentType,parser){customParsers[componentType]=parser}function parseXMLNode(xmlNode){if(xmlNode.nodeType===1){var bindingResults={type:xmlNode.tagName.toLowerCase()};var convertedAttr=convertAttributes(xmlNode.attributes);var customParser=customParsers[bindingResults.type];if(customParser){var result=customParser(xmlNode);if(result&&typeof result!="object"){console.error("Parser must return an object converted from attributes")}else{_.extend(convertedAttr,result)}}var bindingString=objectToDataBindingFormat(convertedAttr,bindingResults);var domNode=document.createElement("div");domNode.setAttribute("data-bind","qpf:"+bindingString);return domNode}else if(xmlNode.nodeType===8){return}else{return}}function convertAttributes(attributes){var ret={};for(var i=0;i<attributes.length;i++){var attr=attributes[i];ret[attr.nodeName]=attr.nodeValue}return ret}function objectToDataBindingFormat(attributes,bindingResults){bindingResults=bindingResults||{};var preProcess=function(attributes,bindingResults){_.each(attributes,function(value,name){if(value.constructor==Array){bindingResults[name]=[];preProcess(value,bindingResults[name])}else if(value.constructor==Object){bindingResults[name]={};preProcess(value,bindingResults[name])}else if(typeof value!=="undefined"){var isBinding=/^\s*@binding\[(.*?)\]\s*$/.exec(value);if(isBinding){value="{{BINDINGSTART"+isBinding[1]+"BINDINGEND}}"}bindingResults[name]=value}})};preProcess(attributes,bindingResults);var bindingString=JSON.stringify(bindingResults);bindingString=bindingString.replace(/\"\{\{BINDINGSTART(.*?)BINDINGEND\}\}\"/g,"$1");return bindingString}function convert(root,parent){var children=getChildren(root);for(var i=0;i<children.length;i++){var node=parseXMLNode(children[i]);if(node){parent.appendChild(node);convert(children[i],node)}}}function getChildren(parent){var children=[];var node=parent.firstChild;while(node){children.push(node);node=node.nextSibling}return children}function getChildrenByTagName(parent,tagName){var children=getChildren(parent);return _.filter(children,function(child){return child.tagName&&child.tagName.toLowerCase()===tagName})}exports.parse=parse;exports.provideParser=provideParser;function getTextContent(xmlNode){var children=getChildren(xmlNode);var text="";_.each(children,function(child){if(child.nodeType==3){text+=child.textContent.replace(/(^\s*)|(\s*$)/g,"")}});return text}exports.util={convertAttributes:convertAttributes,objectToDataBindingFormat:objectToDataBindingFormat,getChildren:getChildren,getChildrenByTagName:getChildrenByTagName,getTextContent:getTextContent}});define("core/mixin/derive",["require","_"],function(require){var _=require("_");function derive(makeDefaultOpt,initialize,proto){if(typeof initialize=="object"){proto=initialize;initialize=null}var extendedProto={"instanceof":function(constructor){var selfConstructor=sub;while(selfConstructor){if(selfConstructor===constructor){return true}selfConstructor=selfConstructor.__super__}}};var _super=this;var sub=function(options){_super.call(this);_.extend(this,typeof makeDefaultOpt=="function"?makeDefaultOpt.call(this):makeDefaultOpt);_.extend(this,options);if(this.constructor==sub){var base=sub,initializeChain=[initialize];while(base.__super__){base=base.__super__;initializeChain.unshift(base.__initialize__)}for(var i=0;i<initializeChain.length;i++){if(initializeChain[i]){initializeChain[i].call(this)}}}};sub.__super__=_super;sub.__initialize__=initialize;_.extend(sub.prototype,_super.prototype,extendedProto,proto);sub.prototype.constructor=sub;sub.derive=_super.derive;return sub}return{derive:derive}});define("core/mixin/event",[],function(){return{trigger:function(){if(!this.__handlers__){return}var name=arguments[0];var params=Array.prototype.slice.call(arguments,1);var handlers=this.__handlers__[name];if(handlers){for(var i=0;i<handlers.length;i+=2){var handler=handlers[i],context=handlers[i+1];handler.apply(context||this,params)}}},on:function(target,handler,context){if(!target){return}var handlers=this.__handlers__||(this.__handlers__={});if(!handlers[target]){handlers[target]=[]}if(handlers[target].indexOf(handler)==-1){handlers[target].push(handler);handlers[target].push(context)}return handler},off:function(target,handler){var handlers=this.__handlers__||(this.__handlers__={});if(handlers[target]){if(handler){var arr=handlers[target];var idx=arr.indexOf(handler);if(idx>=0)arr.splice(idx,2)}else{handlers[target]=[]}}}}});define("core/clazz",["require","./mixin/derive","./mixin/event","_"],function(require){var deriveMixin=require("./mixin/derive");var eventMixin=require("./mixin/event");var _=require("_");var Clazz=new Function;_.extend(Clazz,deriveMixin);_.extend(Clazz.prototype,eventMixin);return Clazz});define("base",["require","core/clazz","core/mixin/event","knockout","$","_"],function(require){var Clazz=require("core/clazz");var Event=require("core/mixin/event");var ko=require("knockout");var $=require("$");var _=require("_");var repository={};var Base=Clazz.derive(function(){return{name:"",tag:"div",attr:{},$el:null,attributes:{},parent:null,skin:"",classPrefix:"qpf-ui-",skinPrefix:"qpf-skin-",id:ko.observable(""),width:ko.observable(),"class":ko.observable(),height:ko.observable(),visible:ko.observable(true),disable:ko.observable(false),style:ko.observable(""),temporary:false,events:{}}},function(){this.__GUID__=genGUID();if(!this.temporary){repository[this.__GUID__]=this}if(!this.$el){this.$el=$(document.createElement(this.tag))}this.$el[0].setAttribute("data-qpf-guid",this.__GUID__);this.$el.attr(this.attr);if(this.skin){this.$el.addClass(this.withPrefix(this.skin,this.skinPrefix))}if(this.css){_.each(_.union(this.css),function(className){this.$el.addClass(this.withPrefix(className,this.classPrefix))},this)}this.width.subscribe(function(newValue){this.$el.width(newValue);this.onResize()},this);this.height.subscribe(function(newValue){this.$el.height(newValue);this.onResize()},this);this.disable.subscribe(function(newValue){this.$el[newValue?"addClass":"removeClass"]("qpf-disable")},this);this.id.subscribe(function(newValue){this.$el.attr("id",newValue)},this);this.class.subscribe(function(newValue){this.$el.addClass(newValue)},this);this.visible.subscribe(function(newValue){newValue?this.$el.show():this.$el.hide()},this);this.style.subscribe(function(newValue){var valueSv=newValue;var styleRegex=/(\S*?)\s*:\s*(.*)/g;newValue="{"+_.chain(newValue.split(";")).map(function(item){return item.replace(/(^\s*)|(\s*$)/g,"").replace(styleRegex,'"$1":"$2"')}).filter(function(item){return item}).value().join(",")+"}";try{var obj=ko.utils.parseJson(newValue);this.$el.css(obj)}catch(e){console.error("Syntax Error of style: "+valueSv)}},this);for(var name in this.events){var handler=this.events[name];if(typeof handler=="function"){this.on(name,handler)}}this._mappingAttributes(this.attributes);this.initialize();this.trigger("initialize")},{type:"BASE",template:"",eventsProvided:["click","mousedown","mouseup","mousemove","resize","initialize","beforerender","render","dispose"],initialize:function(){},set:function(key,value){if(typeof key=="string"){var source={};source[key]=value}else{source=key}this._mappingAttributes(source,true)},render:function(){this.beforeRender&&this.beforeRender();this.trigger("beforerender");this.doRender();this.afterRender&&this.afterRender();this.trigger("render");this.onResize()},doRender:function(){this.$el.children().each(function(){Base.disposeDom(this)});this.$el.html(this.template);ko.applyBindings(this,this.$el[0])},dispose:function(){if(this.$el){this.$el.remove()}repository[this.__GUID__]=null;this.trigger("dispose")},resize:function(width,height){if(typeof width==="number"){this.width(width)}if(typeof height=="number"){this.height(height)}},onResize:function(){this.trigger("resize")},withPrefix:function(className,prefix){if(className.indexOf(prefix)!=0){return prefix+className}},withoutPrefix:function(className,prefix){if(className.indexOf(prefix)==0){return className.substr(prefix.length)}},_mappingAttributes:function(attributes,onlyUpdate){for(var name in attributes){var attr=attributes[name];var propInVM=this[name];if(typeof propInVM==="undefined"){var value=ko.utils.unwrapObservable(attr);if(ko.isObservable(attr)&&attr.push||attr.constructor==Array){this[name]=ko.observableArray(value)}else{this[name]=ko.observable(value)}propInVM=this[name]}else if(ko.isObservable(propInVM)){propInVM(ko.utils.unwrapObservable(attr))}else{this[name]=ko.utils.unwrapObservable(attr)}if(!onlyUpdate){if(ko.isObservable(attr)){bridge(propInVM,attr)}}}}});var proxyEvents=["click","mousedown","mouseup","mousemove"];Base.prototype.on=function(eventName){if(proxyEvents.indexOf(eventName)>=0){this.$el.unbind(eventName,proxyHandler).bind(eventName,{context:this},proxyHandler)}Event.on.apply(this,arguments)};function proxyHandler(e){var context=e.data.context;var eventType=e.type;context.trigger(eventType)}Base.get=function(guid){return repository[guid]};Base.getByDom=function(domNode){var guid=domNode.getAttribute("data-qpf-guid");return Base.get(guid)};Base.disposeDom=function(domNode,resursive){if(typeof recursive=="undefined"){recursive=true}function dispose(node){var guid=node.getAttribute("data-qpf-guid");var component=Base.get(guid);if(component){component.dispose()}else{if(recursive){for(var i=0;i<node.childNodes.length;i++){var child=node.childNodes[i];if(child.nodeType==1){dispose(child)}}}}}dispose(domNode)};var genGUID=function(){var id=0;return function(){return id++}}();ko.extenders.numeric=function(target,precision){var fixer=ko.computed({read:target,write:function(newValue){if(newValue===""){target("");return}else{var val=parseFloat(newValue)}val=isNaN(val)?0:val;var precisionValue=parseFloat(ko.utils.unwrapObservable(precision));if(!isNaN(precisionValue)){var multiplier=Math.pow(10,precisionValue);val=Math.round(val*multiplier)/multiplier}target(val)}});fixer(target());return fixer};ko.extenders.clamp=function(target,options){var min=options.min;var max=options.max;var clamper=ko.computed({read:target,write:function(value){var minValue=parseFloat(ko.utils.unwrapObservable(min)),maxValue=parseFloat(ko.utils.unwrapObservable(max));if(!isNaN(minValue)){value=Math.max(minValue,value)}if(!isNaN(maxValue)){value=Math.min(maxValue,value)}target(value)}});clamper(target());return clamper};var bindings={};Base.provideBinding=function(name,Component){bindings[name]=Component};Base.create=function(name,config){var Constructor=bindings[name];if(Constructor){return new Constructor(config)}};ko.bindingHandlers["qpf"]={createComponent:function(element,valueAccessor){var prevComponent=Base.getByDom(element);if(prevComponent){prevComponent.dispose()}var component=createComponentFromDataBinding(element,valueAccessor,bindings);return component},init:function(element,valueAccessor){var component=ko.bindingHandlers["qpf"].createComponent(element,valueAccessor);component.render();return{controlsDescendantBindings:true}},update:function(element,valueAccessor){}};ko.bindingHandlers["qpf_view"]={init:function(element,valueAccessor){var value=valueAccessor();var subView=ko.utils.unwrapObservable(value);if(subView&&subView.$el){Base.disposeDom(element);element.parentNode.replaceChild(subView.$el[0],element)}return{controlsDescendantBindings:true}},update:function(element,valueAccessor){}};$.fn.qpf=function(op,viewModel){op=op||"get";if(op==="get"){var result=[];this.each(function(){var item=Base.getByDom(this);if(item){result.push(item)}});return result}else if(op==="init"){this.each(function(){ko.applyBindings(viewModel,this)});return this.qpf("get")}else if(op==="dispose"){this.each(function(){Base.disposeDom(this)})}};var unwrap=ko.utils.unwrapObservable;function createComponentFromDataBinding(element,valueAccessor){var value=valueAccessor();var options=unwrap(value)||{};var type=unwrap(options.type);if(type){var Constructor=bindings[type];if(Constructor){var component=createComponentFromJSON(options,Constructor);if(component){element.innerHTML="";element.appendChild(component.$el[0]);$(element).addClass("qpf-wrapper")}element.setAttribute("data-qpf-guid",component.__GUID__)}else{console.error("Unkown UI type, "+type)}}else{console.error("UI type is needed")}return component}function createComponentFromJSON(options,Constructor){var type=unwrap(options.type),name=unwrap(options.name),attr=_.omit(options,"type","name");var events={};_.each(attr,function(value,key){if(key.indexOf("on")==0&&Constructor.prototype.eventsProvided.indexOf(key.substr("on".length))>=0&&typeof value=="function"){delete attr[key];events[key.substr("on".length)]=value}});var component=new Constructor({name:name||"",attributes:attr,events:events});return component}function bridge(target,source){target(source());var commonValue=_.clone(target());target.subscribe(function(newValue){try{if(!_.isEqual(commonValue,newValue)){commonValue=_.clone(newValue);source(newValue)}}catch(e){console.error(e.toString())}});source.subscribe(function(newValue){try{if(!_.isEqual(commonValue,newValue)){commonValue=_.clone(newValue);target(newValue)}}catch(e){console.error(e.toString())}})}return Base});define("util",["require","knockout","core/xmlparser","./base"],function(require){var ko=require("knockout");var XMLParser=require("core/xmlparser");var Base=require("./base");var exports={};exports.createComponentsFromXML=function(XMLString,viewModel){var dom=XMLParser.parse(XMLString);ko.applyBindings(viewModel||{},dom);var ret=[];var node=dom.firstChild;while(node){var component=Base.getByDom(node);if(component){ret.push(component)}node=node.nextSibling}return ret};return exports});define("mixin/draggable",["require","core/mixin/derive","core/mixin/event","knockout","$","_"],function(require){var Derive=require("core/mixin/derive");var Event=require("core/mixin/event");var ko=require("knockout");var $=require("$");var _=require("_");var Clazz=new Function;_.extend(Clazz,Derive);_.extend(Clazz.prototype,Event);var DraggableItem=Clazz.derive(function(){return{id:0,target:null,handle:null,margins:{},originPosition:{},offsetParentOffset:{},width:0,height:0,positionType:"",data:{},host:null}},{setData:function(data){},remove:function(){this.host.remove(this.target)}});var Draggable=Clazz.derive(function(){return{items:{},axis:null,container:null,helper:null,_boundingBox:null,_mouseStart:{},_$helper:null}},{add:function(elem,handle){var id=genGUID(),$elem=$(elem);if(handle){var $handle=$(handle)}$elem.attr("data-qpf-draggable",id).addClass("qpf-draggable");(handle?$(handle):$elem).unbind("mousedown",this._mouseDown).bind("mousedown",{context:this},this._mouseDown);var newItem=new DraggableItem({id:id,target:elem,host:this,handle:handle});this.items[id]=newItem;return newItem},remove:function(elem){if(elem instanceof DraggableItem){var item=elem,$elem=$(item.elem),id=item.id}else{var $elem=$(elem),id=$elem.attr("data-qpf-draggable");if(id){var item=this.items[id]}}delete this.items[id];$elem.removeAttr("data-qpf-draggable").removeClass("qpf-draggable");(item.handle?$(item.handle):$elem).unbind("mousedown",this._mouseDown)},clear:function(){_.each(this.items,function(item){this.remove(item.target)},this)},_save:function(){_.each(this.items,function(item){var $elem=$(item.target);var $offsetParent=$elem.offsetParent();var position=$elem.position();var offsetParentOffset=$offsetParent.offset();var margin={left:parseInt($elem.css("marginLeft"))||0,top:parseInt($elem.css("marginTop"))||0};item.margin=margin;item.originPosition={left:position.left-margin.left,top:position.top-margin.top},item.offsetParentOffset=offsetParentOffset;item.width=$elem.width(),item.height=$elem.height(),item.positionType=$elem.css("position")},this)},_restore:function(restorePosition){_.each(this.items,function(item){var $elem=$(item.target);var position=$elem.offset();$elem.css("position",item.positionType);if(restorePosition){$elem.offset({left:item.originPosition.left+item.margin.left,top:item.originPosition.top+item.margin.top})}else{$elem.offset(position)}},this)},_mouseDown:function(e){if(e.which!==1){return}var self=e.data.context;e.preventDefault();self._save();self._triggerProxy("dragstart",e);if(!self.helper){_.each(self.items,function(item){var $elem=$(item.target);$elem.addClass("qpf-draggable-dragging");$elem.css({position:"absolute",left:item.originPosition.left+"px",top:item.originPosition.top+"px"})},self);if(self.container){self._boundingBox=self._computeBoundingBox(self.container)}else{self._boundingBox=null}}else{self._$helper=$(self.helper);document.body.appendChild(self._$helper[0]);self._$helper.css({left:e.pageX,top:e.pageY})}$(document.body).unbind("mousemove",self._mouseMove).bind("mousemove",{context:self},self._mouseMove).unbind("mouseout",self._mouseOut).bind("mouseout",{context:self},self._mouseOut).unbind("mouseup",self._mouseUp).bind("mouseup",{context:self},self._mouseUp);self._mouseStart={x:e.pageX,y:e.pageY}},_computeBoundingBox:function(container){if(_.isArray(container)){return{left:container[0][0],top:container[0][1],right:container[1][0],bottom:container[1][1]}}else if(container.left&&container.right&&container.top&&container.bottom){return container}else{try{var $container=$(container);var offset=$container.offset();var bb={left:offset.left+parseInt($container.css("padding-left"))||0,top:offset.top+parseInt($container.css("padding-top"))||0,right:offset.left+$container.width()-parseInt($container.css("padding-right"))||0,bottom:offset.top+$container.height()-parseInt($container.css("padding-bottom"))||0};return bb}catch(e){console.error("Invalid container type")}}},_mouseMove:function(e){var self=e.data.context;var offset={x:e.pageX-self._mouseStart.x,y:e.pageY-self._mouseStart.y};if(!self._$helper){_.each(self.items,function(item){var left=item.originPosition.left+item.offsetParentOffset.left+offset.x,top=item.originPosition.top+item.offsetParentOffset.top+offset.y;if(self._boundingBox){var bb=self._boundingBox;left=left>bb.left?left+item.width<bb.right?left:bb.right-item.width:bb.left;top=top>bb.top?top+item.height<bb.bottom?top:bb.bottom-item.height:bb.top}var axis=ko.utils.unwrapObservable(self.axis);if(!axis||axis.toLowerCase()!=="y"){$(item.target).css("left",left-item.offsetParentOffset.left+"px")}if(!axis||axis.toLowerCase()!=="x"){$(item.target).css("top",top-item.offsetParentOffset.top+"px")}},self)}else{self._$helper.css({left:e.pageX,top:e.pageY})}self._triggerProxy("drag",e)},_mouseUp:function(e){var self=e.data.context;$(document.body).unbind("mousemove",self._mouseMove).unbind("mouseout",self._mouseOut).unbind("mouseup",self._mouseUp);if(self._$helper){self._$helper.remove()}else{_.each(self.items,function(item){var $elem=$(item.target);$elem.removeClass("qpf-draggable-dragging")},self)}self._restore();self._triggerProxy("dragend",e)},_mouseOut:function(e){},_triggerProxy:function(){var args=arguments;_.each(this.items,function(item){item.trigger.apply(item,args)});this.trigger.apply(this,args)}});var genGUID=function(){var id=1;return function(){return id++}}();Draggable.applyTo=function(target,options){target.draggable=new Draggable(options)};return Draggable});define("meta/meta",["require","../base","knockout"],function(require){var Base=require("../base");var ko=require("knockout");var Meta=Base.derive({},{type:"META",css:"meta"});Meta.provideBinding=Base.provideBinding;Meta.provideBinding("meta",Meta);return Meta});define("meta/button",["require","./meta","core/xmlparser","knockout","$","_"],function(require){var Meta=require("./meta");var XMLParser=require("core/xmlparser");var ko=require("knockout");var $=require("$");var _=require("_");var Button=Meta.derive(function(){return{$el:$('<button data-bind="html:text"></button>'),text:ko.observable("Button")}},{type:"BUTTON",css:"button",afterRender:function(){var me=this}});Meta.provideBinding("button",Button);XMLParser.provideParser("button",function(xmlNode){var text=XMLParser.util.getTextContent(xmlNode);if(text){return{text:text}}});return Button});define("meta/checkbox",["require","./meta","knockout","$","_"],function(require){var Meta=require("./meta");var ko=require("knockout");var $=require("$");var _=require("_");var Checkbox=Meta.derive(function(){return{checked:ko.observable(false),label:ko.observable("")}},{template:'<input type="checkbox" data-bind="checked:checked" />                <span data-bind="css:{checked:checked}"></span>                <label data-bind="text:label"></label>',type:"CHECKBOX",css:"checkbox",afterRender:function(){var self=this;this.$el.click(function(){self.checked(!self.checked())})}});Meta.provideBinding("checkbox",Checkbox);return Checkbox});define("meta/combobox",["require","./meta","core/xmlparser","knockout","$","_"],function(require){var Meta=require("./meta");var XMLParser=require("core/xmlparser");var ko=require("knockout");var $=require("$");var _=require("_");var Combobox=Meta.derive(function(){return{$el:$('<div data-bind="css:{active:active}" tabindex="0"></div>'),value:ko.observable(),items:ko.observableArray(),defaultText:ko.observable("select"),active:ko.observable(false)}},{type:"COMBOBOX",css:"combobox",eventsProvided:_.union(Meta.prototype.eventsProvided,"change"),initialize:function(){this.selectedText=ko.computed(function(){var val=this.value();var result=_.filter(this.items(),function(item){return ko.utils.unwrapObservable(item.value)==val})[0];if(typeof result=="undefined"){return this.defaultText()}return ko.utils.unwrapObservable(result.text)},this)},template:'<div class="qpf-combobox-selected" data-bind="click:_toggle">                    <div class="qpf-left" data-bind="html:selectedText"></div>                    <div class="qpf-right qpf-common-button">                        <div class="qpf-icon"></div>                    </div>                </div>                <ul class="qpf-combobox-items" data-bind="foreach:items">                    <li data-bind="html:text,attr:{\'data-qpf-value\':value},click:$parent._select.bind($parent,value),css:{selected:$parent._isSelected(value)}"></li>                </ul>',afterRender:function(){var self=this;this._$selected=this.$el.find(".qpf-combobox-selected");this._$items=this.$el.find(".qpf-combobox-items");this.$el.blur(function(){self._blur()})},_focus:function(){this.active(true)},_blur:function(){this.active(false)},_toggle:function(){this.active(!this.active())},_select:function(value){value=ko.utils.unwrapObservable(value);this.value(value);this._blur()},_isSelected:function(value){return this.value()===ko.utils.unwrapObservable(value)}});Meta.provideBinding("combobox",Combobox);XMLParser.provideParser("combobox",function(xmlNode){var items=[];var nodes=XMLParser.util.getChildrenByTagName(xmlNode,"item");_.each(nodes,function(child){var value=child.getAttribute("value");var text=child.getAttribute("text")||XMLParser.util.getTextContent(child);if(value!==null){items.push({value:value,text:text})}});if(items.length){return{items:items}}});return Combobox});define("meta/label",["require","./meta","core/xmlparser","knockout","$","_"],function(require){var Meta=require("./meta");var XMLParser=require("core/xmlparser");var ko=require("knockout");var $=require("$");var _=require("_");var Label=Meta.derive(function(){return{text:ko.observable("Label")}},{template:'<Label data-bind="html:text"></Label>',type:"LABEL",css:"label"});Meta.provideBinding("label",Label);XMLParser.provideParser("label",function(xmlNode){var text=XMLParser.util.getTextContent(xmlNode);if(text){return{text:text}}});return Label});define("meta/slider",["require","./meta","../mixin/draggable","knockout","$","_"],function(require){var Meta=require("./meta");var Draggable=require("../mixin/draggable");var ko=require("knockout");var $=require("$");var _=require("_");var Slider=Meta.derive(function(){var ret={$el:$('<div data-bind="css:orientation"></div>'),step:ko.observable(1),min:ko.observable(-100),max:ko.observable(100),orientation:ko.observable("horizontal"),precision:ko.observable(2),format:"{{value}}",_format:function(number){return this.format.replace("{{value}}",number)},autoResize:true};ret.value=ko.observable(1).extend({clamp:{max:ret.max,min:ret.min}});ret._valueNumeric=ko.computed(function(){return ret.value().toFixed(ret.precision())});ret._percentageStr=ko.computed({read:function(){var min=ret.min();var max=ret.max();var value=ret.value();var percentage=(value-min)/(max-min);return percentage*100+"%"},deferEvaluation:true});return ret},{type:"SLIDER",css:"slider",template:'<div class="qpf-slider-groove-box">                    <div class="qpf-slider-groove">                        <div class="qpf-slider-percentage" data-bind="style:{width:_percentageStr}"></div>                    </div>                </div>                <div class="qpf-slider-min" data-bind="text:_format(min())"></div>                <div class="qpf-slider-max" data-bind="text:_format(max())"></div>                <div class="qpf-slider-control" data-bind="style:{left:_percentageStr}">                    <div class="qpf-slider-control-inner"></div>                    <div class="qpf-slider-value" data-bind="text:_format(_valueNumeric())"></div>                </div>',eventsProvided:_.union(Meta.prototype.eventsProvided,"change"),initialize:function(){Draggable.applyTo(this,{axis:ko.computed(function(){return this.orientation()=="horizontal"?"x":"y"},this)});var prevValue=this._valueNumeric();this.value.subscribe(function(){this.trigger("change",this._valueNumeric(),prevValue,this);prevValue=this._valueNumeric()},this)},afterRender:function(){this._$groove=this.$el.find(".qpf-slider-groove");this._$percentage=this.$el.find(".qpf-slider-percentage");this._$control=this.$el.find(".qpf-slider-control");this.draggable.container=this._$groove;var item=this.draggable.add(this._$control);item.on("drag",this._dragHandler,this);this.$el.mousedown(function(e){e.preventDefault()})},onResize:function(){Meta.prototype.onResize.call(this)},computePercentage:function(){if(this.autoResize){this._cacheSize()}var offset=this._computeOffset();return offset/(this._grooveSize-this._sliderSize)},_cacheSize:function(){var isHorizontal=this._isHorizontal();this._grooveSize=isHorizontal?this._$groove.width():this._$groove.height();this._sliderSize=isHorizontal?this._$control.width():this._$control.height()
},_computeOffset:function(){var isHorizontal=this._isHorizontal();var grooveOffset=isHorizontal?this._$groove.offset().left:this._$groove.offset().top;var sliderOffset=isHorizontal?this._$control.offset().left:this._$control.offset().top;return sliderOffset-grooveOffset},_dragHandler:function(){var percentage=this.computePercentage(),min=parseFloat(this.min()),max=parseFloat(this.max()),value=(max-min)*percentage+min;this.value(value)},_isHorizontal:function(){return ko.utils.unwrapObservable(this.orientation)=="horizontal"}});Meta.provideBinding("slider",Slider);return Slider});define("meta/spinner",["require","./meta","knockout","$","_"],function(require){var Meta=require("./meta");var ko=require("knockout");var $=require("$");var _=require("_");function increase(){this.value(parseFloat(this.value())+parseFloat(this.step()))}function decrease(){this.value(parseFloat(this.value())-parseFloat(this.step()))}var Spinner=Meta.derive(function(){var ret={step:ko.observable(1),valueUpdate:"afterkeydown",precision:ko.observable(2),min:ko.observable(null),max:ko.observable(null),increase:increase,decrease:decrease};ret.value=ko.observable(1).extend({numeric:ret.precision,clamp:{max:ret.max,min:ret.min}});return ret},{type:"SPINNER",css:"spinner",initialize:function(){var prevValue=this.value()||0;this.value.subscribe(function(newValue){this.trigger("change",parseFloat(newValue),parseFloat(prevValue),this);prevValue=newValue},this)},eventsProvided:_.union(Meta.prototype.eventsProvided,"change"),template:'<div class="qpf-left">					<input type="text" class="qpf-spinner-value" data-bind="value:value,valueUpdate:valueUpdate" />				</div>				<div class="qpf-right">					<div class="qpf-common-button qpf-increase" data-bind="click:increase">					+</div>					<div class="qpf-common-button qpf-decrease" data-bind="click:decrease">					-</div>				</div>',afterRender:function(){var self=this;this.$el.find(".qpf-increase,.qpf-decrease").mousedown(function(e){e.preventDefault()});this._$value=this.$el.find(".qpf-spinner-value");this._$value.keydown(function(event){if(event.keyCode==46||event.keyCode==8||event.keyCode==9||event.keyCode==27||event.keyCode==190||event.keyCode==65&&event.ctrlKey===true||event.keyCode>=35&&event.keyCode<=39){return}else{if(event.shiftKey||(event.keyCode<48||event.keyCode>57)&&(event.keyCode<96||event.keyCode>105)){event.preventDefault()}}});this._$value.change(function(){if(this.value!==self.value().toString()){this.value=self.value()}})}});Meta.provideBinding("spinner",Spinner);return Spinner});define("meta/textfield",["require","./meta","knockout","_"],function(require){var Meta=require("./meta");var ko=require("knockout");var _=require("_");var TextField=Meta.derive(function(){return{tag:"div",text:ko.observable(""),placeholder:ko.observable("")}},{type:"TEXTFIELD",css:"textfield",template:'<input type="text" data-bind="attr:{placeholder:placeholder}, value:text"/>',onResize:function(){this.$el.find("input").width(this.width());Meta.prototype.onResize.call(this)}});Meta.provideBinding("textfield",TextField);return TextField});define("container/container",["require","../base","knockout","$","_"],function(require){var Base=require("../base");var ko=require("knockout");var $=require("$");var _=require("_");var Container=Base.derive(function(){return{children:ko.observableArray()}},{type:"CONTAINER",css:"container",template:'<div data-bind="foreach:children" class="qpf-children">                    <div data-bind="qpf_view:$data"></div>                </div>',initialize:function(){var self=this,oldArray=this.children().slice();this.children.subscribe(function(newArray){var differences=ko.utils.compareArrays(oldArray,newArray);_.each(differences,function(item){if(item.status=="added"){item.value.on("dispose",_onItemDispose,item.value)}else if(item.status=="deleted"){item.value.off("dispose",_onItemDispose)}},this)});function _onItemDispose(){self.remove(this)}},add:function(sub){sub.parent=this;this.children.push(sub);sub.onResize()},remove:function(sub){sub.parent=null;this.children.remove(sub)},removeAll:function(){_.each(this.children(),function(child){child.parent=null},this);this.children([])},children:function(){return this.children()},doRender:function(){Base.prototype.doRender.call(this);_.each(this.children(),function(child){child.render()})},onResize:function(){if(this.height()){this.$el.children(".qpf-children").height(this.height())}_.each(this.children(),function(child){child.onResize()},this);Base.prototype.onResize.call(this)},dispose:function(){_.each(this.children(),function(child){child.dispose()});Base.prototype.dispose.call(this)},get:function(name){if(!name){return}return _.filter(this.children(),function(item){return item.name===name})[0]}});Container.provideBinding=Base.provideBinding;var baseBindler=ko.bindingHandlers["qpf"];ko.bindingHandlers["qpf"]={init:function(element,valueAccessor,allBindingsAccessor,viewModel){var childNodes=Array.prototype.slice.call(element.childNodes);var component=baseBindler.createComponent(element,valueAccessor);if(component&&component.instanceof(Container)){var subViewModel={__deferredrender__:true};_.extend(subViewModel,viewModel);for(var i=0;i<childNodes.length;i++){var child=childNodes[i];if(ko.bindingProvider.prototype.nodeHasBindings(child)){ko.applyBindings(subViewModel,child);var sub=Base.getByDom(child);if(sub){component.add(sub)}}}}if(!viewModel["__deferredrender__"]){component.render()}return{controlsDescendantBindings:true}},update:function(element,valueAccessor){baseBindler.update(element,valueAccessor)}};Container.provideBinding("container",Container);return Container});define("container/panel",["require","./container","knockout","$"],function(require){var Container=require("./container");var ko=require("knockout");var $=require("$");var Panel=Container.derive(function(){return{title:ko.observable("")}},{type:"PANEL",css:"panel",template:'<div class="qpf-panel-header">                    <div class="qpf-panel-title" data-bind="html:title"></div>                    <div class="qpf-panel-tools"></div>                </div>                <div class="qpf-panel-body" data-bind="foreach:children" class="qpf-children">                    <div data-bind="qpf_view:$data"></div>                </div>                <div class="qpf-panel-footer"></div>',afterRender:function(){var $el=this.$el;this._$header=$el.children(".qpf-panel-header");this._$tools=this._$header.children(".qpf-panel-tools");this._$body=$el.children(".qpf-panel-body");this._$footer=$el.children(".qpf-panel-footer")},onResize:function(){if(this._$body&&this.height()){var headerHeight=this._$header.height();var footerHeight=this._$footer.height();this._$body.height(this.$el.height()-headerHeight-footerHeight)}Container.prototype.onResize.call(this)}});Container.provideBinding("panel",Panel);return Panel});define("container/window",["require","./container","./panel","../mixin/draggable","knockout","$","_"],function(require){var Container=require("./container");var Panel=require("./panel");var Draggable=require("../mixin/draggable");var ko=require("knockout");var $=require("$");var _=require("_");var Window=Panel.derive(function(){return{$el:$('<div data-bind="style:{left:_leftPx, top:_topPx}"></div>'),children:ko.observableArray(),title:ko.observable("Window"),left:ko.observable(0),top:ko.observable(0),_leftPx:ko.computed(function(){return this.left()+"px"},this,{deferEvaluation:true}),_topPx:ko.computed(function(){return this.top()+"px"},this,{deferEvaluation:true})}},{type:"WINDOW",css:_.union("window",Panel.prototype.css),initialize:function(){Draggable.applyTo(this);Panel.prototype.initialize.call(this)},afterRender:function(){Panel.prototype.afterRender.call(this);this.draggable.add(this.$el,this._$header)}});Container.provideBinding("window",Window);return Window});define("container/tab",["require","./container","./panel","knockout","$","_"],function(require){var Container=require("./container");var Panel=require("./panel");var ko=require("knockout");var $=require("$");var _=require("_");var Tab=Panel.derive(function(){var ret={actived:ko.observable(0),maxTabWidth:100,minTabWidth:30};ret.actived.subscribe(function(idx){this._active(idx)},this);return ret},{type:"TAB",css:"tab",add:function(item){if(item.instanceof(Panel)){Panel.prototype.add.call(this,item)}else{console.error("Children of tab container must be instance of panel")}this._active(this.actived())},eventsProvided:_.union("change",Container.prototype.eventsProvided),initialize:function(){this.children.subscribe(function(){this._updateTabSize()},this);Panel.prototype.initialize.call(this)},template:'<div class="qpf-tab-header">                    <ul class="qpf-tab-tabs" data-bind="foreach:children">                        <li data-bind="click:$parent.actived.bind($data, $index())">                            <a data-bind="html:title"></a>                        </li>                    </ul>                    <div class="qpf-tab-tools"></div>                </div>                <div class="qpf-tab-body">                    <div class="qpf-tab-views" data-bind="foreach:children" class="qpf-children">                        <div data-bind="qpf_view:$data"></div>                    </div>                </div>                <div class="qpf-tab-footer"></div>',afterRender:function(){this._updateTabSize();var $el=this.$el;this._$header=$el.children(".qpf-tab-header");this._$tools=this._$header.children(".qpf-tab-tools");this._$body=$el.children(".qpf-tab-body");this._$footer=$el.children(".qpf-tab-footer");this._active(this.actived())},onResize:function(){this._adjustCurrentSize();this._updateTabSize();Container.prototype.onResize.call(this)},_unActiveAll:function(){_.each(this.children(),function(child){child.$el.css("display","none")})},_updateTabSize:function(){var length=this.children().length,tabSize=Math.floor((this.$el.width()-20)/length);tabSize=Math.min(this.maxTabWidth,Math.max(this.minTabWidth,tabSize));this.$el.find(".qpf-tab-header>.qpf-tab-tabs>li").width(tabSize)},_adjustCurrentSize:function(){var current=this.children()[this.actived()];if(current&&this._$body){var headerHeight=this._$header.height(),footerHeight=this._$footer.height();if(this.height()&&this.height()!=="auto"){current.height(this.$el.height()-headerHeight-footerHeight)}if(this.width()=="auto"){}}},_active:function(idx){this._unActiveAll();var current=this.children()[idx];if(current){current.$el.css("display","block");this._adjustCurrentSize();current.onResize();this.trigger("change",idx,current)}this.$el.find(".qpf-tab-header>.qpf-tab-tabs>li").removeClass("actived").eq(idx).addClass("actived")}});Container.provideBinding("tab",Tab);return Tab});define("container/box",["require","./container","knockout","$","_"],function(require){var Container=require("./container");var ko=require("knockout");var $=require("$");var _=require("_");var Box=Container.derive(function(){return{}},{type:"BOX",css:"box",initialize:function(){this.children.subscribe(function(children){this.onResize()},this);this.$el.css("position","relative");Container.prototype.initialize.call(this)},_getMargin:function($el){return{left:parseInt($el.css("marginLeft"))||0,top:parseInt($el.css("marginTop"))||0,bottom:parseInt($el.css("marginBottom"))||0,right:parseInt($el.css("marginRight"))||0}},_resizeTimeout:0,onResize:function(){var self=this;if(this._resizeTimeout){clearTimeout(this._resizeTimeout)}this._resizeTimeout=setTimeout(function(){self.resizeChildren();Container.prototype.onResize.call(self)})}});return Box});define("container/vbox",["require","./container","./box","knockout","$","_"],function(require){var Container=require("./container");var Box=require("./box");var ko=require("knockout");var $=require("$");var _=require("_");var vBox=Box.derive(function(){return{}},{type:"VBOX",css:"vbox",resizeChildren:function(){var flexSum=0,remainderHeight=this.$el.height(),childrenWithFlex=[];marginCache=[],marginCacheWithFlex=[];_.each(this.children(),function(child){var margin=this._getMargin(child.$el);marginCache.push(margin);child.width(this.$el.width()-margin.left-margin.right);var prefer=ko.utils.unwrapObservable(child.prefer);if(prefer){prefer=Math.min(prefer,remainderHeight);child.height(prefer);remainderHeight-=prefer+margin.top+margin.bottom}else{var flex=parseInt(ko.utils.unwrapObservable(child.flex)||1);childrenWithFlex.push(child);marginCacheWithFlex.push(margin);flexSum+=flex}},this);_.each(childrenWithFlex,function(child,idx){var margin=marginCacheWithFlex[idx];var flex=parseInt(ko.utils.unwrapObservable(child.flex)||1),ratio=flex/flexSum;child.height(Math.floor(remainderHeight*ratio)-margin.top-margin.bottom)});var prevHeight=0;_.each(this.children(),function(child,idx){var margin=marginCache[idx];child.$el.css({position:"absolute",left:"0px",top:prevHeight+"px"});prevHeight+=child.height()+margin.top+margin.bottom})}});Container.provideBinding("vbox",vBox);return vBox});define("container/hbox",["require","./container","./box","knockout","$","_"],function(require){var Container=require("./container");var Box=require("./box");var ko=require("knockout");var $=require("$");var _=require("_");var hBox=Box.derive(function(){return{}},{type:"HBOX",css:"hbox",resizeChildren:function(){var flexSum=0;var remainderWidth=this.$el.width();var childrenWithFlex=[];var marginCache=[];var marginCacheWithFlex=[];_.each(this.children(),function(child,idx){var margin=this._getMargin(child.$el);marginCache.push(margin);child.height(this.$el.height()-margin.top-margin.bottom);var prefer=ko.utils.unwrapObservable(child.prefer);if(prefer){prefer=Math.min(prefer,remainderWidth);child.width(prefer);remainderWidth-=prefer+margin.left+margin.right}else{var flex=parseInt(ko.utils.unwrapObservable(child.flex)||1);childrenWithFlex.push(child);marginCacheWithFlex.push(margin);flexSum+=flex}},this);_.each(childrenWithFlex,function(child,idx){var margin=marginCacheWithFlex[idx];var flex=parseInt(ko.utils.unwrapObservable(child.flex)||1);var ratio=flex/flexSum;child.width(Math.floor(remainderWidth*ratio)-margin.left-margin.right)});var prevWidth=0;_.each(this.children(),function(child,idx){var margin=marginCache[idx];child.$el.css({position:"absolute",top:"0px",left:prevWidth+"px"});prevWidth+=child.width()+margin.left+margin.right})}});Container.provideBinding("hbox",hBox);return hBox});define("container/inline",["require","./container","knockout","$"],function(require){var Container=require("./container");var ko=require("knockout");var $=require("$");var Inline=Container.derive({},{type:"INLINE",css:"inline",template:'<div data-bind="foreach:children" class="qpf-children">                    <div data-bind="qpf_view:$data"></div>                </div>                <div style="clear:both"></div>'});Container.provideBinding("inline",Inline);return Inline});define("container/application",["require","./container","knockout","$"],function(require){var Container=require("./container");var ko=require("knockout");var $=require("$");var Application=Container.derive(function(){},{type:"APPLICATION",css:"application",initialize:function(){$(window).resize(this._resize.bind(this));this._resize()},_resize:function(){this.width($(window).width());this.height($(window).height())}});Container.provideBinding("application",Application);return Application});define("widget/widget",["require","../base","../meta/meta","../container/container","knockout","_"],function(require){var Base=require("../base");var Meta=require("../meta/meta");var Container=require("../container/container");var ko=require("knockout");var _=require("_");var Widget=Base.derive({},{type:"WIDGET",css:"widget"});Widget.provideBinding=Base.provideBinding;Widget.provideBinding("widget",Widget);return Widget});define("widget/vector",["require","./widget","../base","core/xmlparser","knockout","$","../meta/spinner","../meta/slider","_"],function(require){var Widget=require("./widget");var Base=require("../base");var XMLParser=require("core/xmlparser");var ko=require("knockout");var $=require("$");var Spinner=require("../meta/spinner");var Slider=require("../meta/slider");var _=require("_");var Vector=Widget.derive(function(){return{items:ko.observableArray(),constrainProportion:ko.observable(false),constrainType:ko.observable("diff"),_toggleConstrain:function(){this.constrainProportion(!this.constrainProportion())},_constrainRatio:[],_constrainDiff:[],_sub:[]}},{type:"VECTOR",css:"vector",initialize:function(){this.$el.attr("data-bind",'css:{"qpf-vector-constrain":constrainProportion}');this.items.subscribe(function(item){if(this._$list){this._cacheSubComponents();this._updateConstraint()}},this);this.constrainProportion.subscribe(function(constrain){if(constrain){this._computeContraintInfo()}},this)},eventsProvided:_.union(Widget.prototype.eventsProvided,"change"),template:'<div class="qpf-left">                    <div class="qpf-vector-link" data-bind="click:_toggleConstrain"></div>                </div>                <div class="qpf-right" >                    <ul class="qpf-list" data-bind="foreach:items">                        <li data-bind="qpf:$data"></li>                    </ul>                </div>',afterRender:function(){this._$list=this.$el.find(".qpf-list");this._cacheSubComponents();this._updateConstraint()},onResize:function(){_.each(this._sub,function(item){item.onResize()});Widget.prototype.onResize.call(this)},dispose:function(){_.each(this._sub,function(item){item.dispose()});Base.prototype.dispose.call(this)},_cacheSubComponents:function(){var self=this;self._sub=[];this._$list.children().each(function(){var component=Base.getByDom(this);self._sub.push(component)});this._computeContraintInfo()},_computeContraintInfo:function(){this._constrainDiff=[];this._constrainRatio=[];_.each(this._sub,function(sub,idx){var next=this._sub[idx+1];if(!next){return}var value=sub.value(),nextValue=next.value();this._constrainDiff.push(nextValue-value);this._constrainRatio.push(value==0?1:nextValue/value)},this)},_updateConstraint:function(){_.each(this._sub,function(sub){sub.on("change",this._constrainHandler,this)},this)},_constrainHandler:function(newValue,prevValue,sub){if(this.constrainProportion()){var selfIdx=this._sub.indexOf(sub),constrainType=this.constrainType();for(var i=selfIdx;i>0;i--){var current=this._sub[i].value,prev=this._sub[i-1].value;if(constrainType=="diff"){var diff=this._constrainDiff[i-1];prev(current()-diff)}else if(constrainType=="ratio"){var ratio=this._constrainRatio[i-1];prev(current()/ratio)}}for(var i=selfIdx;i<this._sub.length-1;i++){var current=this._sub[i].value,next=this._sub[i+1].value;if(constrainType=="diff"){var diff=this._constrainDiff[i];next(current()+diff)}else if(constrainType=="ratio"){var ratio=this._constrainRatio[i];next(current()*ratio)}}}}});Widget.provideBinding("vector",Vector);XMLParser.provideParser("vector",function(xmlNode){var items=[];var children=XMLParser.util.getChildren(xmlNode);_.chain(children).filter(function(child){var tagName=child.tagName&&child.tagName.toLowerCase();return tagName&&(tagName==="spinner"||tagName==="slider")}).each(function(child){var attributes=XMLParser.util.convertAttributes(child.attributes);attributes.type=child.tagName.toLowerCase();items.push(attributes)});if(items.length){return{items:items}}});return Vector});define("widget/color_vm",["require","knockout","core/clazz","_"],function(require){var ko=require("knockout");var Clazz=require("core/clazz");var _=require("_");function rgbToHsv(r,g,b){r=r/255,g=g/255,b=b/255;var max=Math.max(r,g,b),min=Math.min(r,g,b);var h,s,v=max;var d=max-min;s=max==0?0:d/max;if(max==min){h=0}else{switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break}h/=6}return[h*360,s*100,v*100]}function hsvToRgb(h,s,v){h=h/360;s=s/100;v=v/100;var r,g,b;var i=Math.floor(h*6);var f=h*6-i;var p=v*(1-s);var q=v*(1-f*s);var t=v*(1-(1-f)*s);switch(i%6){case 0:r=v,g=t,b=p;break;case 1:r=q,g=v,b=p;break;case 2:r=p,g=v,b=t;break;case 3:r=p,g=q,b=v;break;case 4:r=t,g=p,b=v;break;case 5:r=v,g=p,b=q;break}return[Math.round(r*255),Math.round(g*255),Math.round(b*255)]}function intToRgb(value){var r=value>>16&255,g=value>>8&255,b=value&255;return[r,g,b]}function rgbToInt(r,g,b){return r<<16|g<<8|b}function intToHsv(value){var rgb=intToRgb(value);return rgbToHsv(rgb[0],rgb[1],rgb[2])}function hsvToInt(h,s,v){return rgbToInt(hsvToRgb(h,s,v))}var Color=Clazz.derive({_r:ko.observable().extend({numeric:0}),_g:ko.observable().extend({numeric:0}),_b:ko.observable().extend({numeric:0}),_h:ko.observable().extend({clamp:{min:0,max:360}}),_s:ko.observable().extend({clamp:{min:0,max:100}}),_v:ko.observable().extend({clamp:{min:0,max:100}}),alpha:ko.observable(1).extend({numeric:2,clamp:{min:0,max:1}})},function(){this.hex=ko.computed({read:function(){return rgbToInt(this._r(),this._g(),this._b())},write:function(value){var hsv=intToHsv(value);this._h(hsv[0]);this._s(hsv[1]);this._v(hsv[2])}},this);this.rgb=ko.computed({read:function(){var rgb=hsvToRgb(this._h(),this._s(),this._v());this._r(rgb[0]);this._g(rgb[1]);this._b(rgb[2]);return rgb}},this);this.hsv=ko.computed(function(){return[this._h(),this._s(),this._v()]},this);this.set=function(hex){var hsv=intToHsv(hex);var rgb=intToRgb(hex);this._h(hsv[0]);this._s(hsv[1]);this._v(hsv[2]);this._r(rgb[0]);this._g(rgb[1]);this._b(rgb[2])};this.hexString=ko.computed({read:function(){var string=this.hex().toString(16),fill=[];for(var i=0;i<6-string.length;i++){fill.push("0")}return fill.join("")+string},write:function(){}},this);this.hueRGB=ko.computed(function(){return"rgb("+hsvToRgb(this._h(),100,100).join(",")+")"},this);var vector=["_r","_g","_b"];this.rgbVector=[];for(var i=0;i<3;i++){this.rgbVector.push({type:"spinner",min:0,max:255,step:1,precision:0,value:this[vector[i]]})}var vector=["_h","_s","_v"];this.hsvVector=[];for(var i=0;i<3;i++){this.hsvVector.push({type:"spinner",min:0,max:100,step:1,precision:0,value:this[vector[i]]})}this.hsvVector[0].max=360;this.set(16777215)});Color.intToRgb=intToRgb;Color.rgbToInt=rgbToInt;Color.rgbToHsv=rgbToHsv;Color.hsvToRgb=hsvToRgb;Color.intToHsv=intToHsv;Color.hsvToInt=hsvToInt;return Color});define("widget/palette",["require","./widget","knockout","./color_vm","$","_","widget/vector","meta/textfield","meta/slider"],function(require){var Widget=require("./widget");var ko=require("knockout");var Color=require("./color_vm");var $=require("$");var _=require("_");require("widget/vector");require("meta/textfield");require("meta/slider");var Palette=Widget.derive(function(){var ret=new Color;var self=this;_.extend(ret,{_recent:ko.observableArray(),_recentMax:5});return ret},{type:"PALETTE",css:"palette",eventsProvided:_.union(Widget.prototype.eventsProvided,["change","apply"]),template:'<div class="qpf-palette-adjuster">                    <div class="qpf-left">                        <div class="qpf-palette-picksv" data-bind="style:{backgroundColor:hueRGB}">                            <div class="qpf-palette-saturation">                                <div class="qpf-palette-value"></div>                            </div>                            <div class="qpf-palette-picker"></div>                        </div>                        <div class="qpf-palette-pickh">                            <div class="qpf-palette-picker"></div>                        </div>                        <div style="clear:both"></div>                        <div class="qpf-palette-alpha">                            <div class="qpf-palette-alpha-slider" data-bind="qpf:{type:\'slider\', min:0, max:1, value:alpha, precision:2}"></div>                        </div>                    </div>                    <div class="qpf-right">                        <div class="qpf-palette-rgb">                            <div data-bind="qpf:{type:\'label\', text:\'RGB\'}"></div>                            <div data-bind="qpf:{type:\'vector\', items:rgbVector}"></div>                        </div>                        <div class="qpf-palette-hsv">                            <div data-bind="qpf:{type:\'label\', text:\'HSV\'}"></div>                            <div data-bind="qpf:{type:\'vector\', items:hsvVector}"></div>                        </div>                        <div class="qpf-palette-hex">                            <div data-bind="qpf:{type:\'label\', text:\'#\'}"></div>                            <div data-bind="qpf:{type:\'textfield\',text:hexString}"></div>                        </div>                    </div>                </div>                <div style="clear:both"></div>                <ul class="qpf-palette-recent" data-bind="foreach:_recent">                    <li data-bind="style:{backgroundColor:rgbString},                                    attr:{title:hexString},                                    click:$parent.hex.bind($parent, hex)"></li>                </ul>                <div class="qpf-palette-buttons">                    <div data-bind="qpf:{type:\'button\', text:\'Cancel\', class:\'small\', onclick:_cancel.bind($data)}"></div>                    <div data-bind="qpf:{type:\'button\', text:\'Apply\', class:\'small\', onclick:_apply.bind($data)}"></div>                </div>',initialize:function(){this.hsv.subscribe(function(hsv){this._setPickerPosition();this.trigger("change",this.hex())},this);this._h.subscribe(this._setPickerPosition,this)},afterRender:function(){this._$svSpace=$(".qpf-palette-picksv");this._$hSpace=$(".qpf-palette-pickh");this._$svPicker=this._$svSpace.children(".qpf-palette-picker");this._$hPicker=this._$hSpace.children(".qpf-palette-picker");this._svSize=this._$svSpace.height();this._hSize=this._$hSpace.height();this._setPickerPosition();this._setupSvDragHandler();this._setupHDragHandler()},onResize:function(){var $slider=this.$el.find(".qpf-palette-alpha-slider");if($slider.length){$slider.qpf("get")[0].onResize()}Widget.prototype.onResize.call(this)},_setupSvDragHandler:function(){var self=this;var _getMousePos=function(e){var offset=self._$svSpace.offset(),left=e.pageX-offset.left,top=e.pageY-offset.top;return{left:left,top:top}};var _mouseMoveHandler=function(e){var pos=_getMousePos(e);self._computeSV(pos.left,pos.top)};var _mouseUpHandler=function(e){$(document.body).unbind("mousemove",_mouseMoveHandler).unbind("mouseup",_mouseUpHandler).unbind("mousedown",_disableSelect)};var _disableSelect=function(e){e.preventDefault()};this._$svSpace.mousedown(function(e){var pos=_getMousePos(e);self._computeSV(pos.left,pos.top);$(document.body).bind("mousemove",_mouseMoveHandler).bind("mouseup",_mouseUpHandler).bind("mousedown",_disableSelect)})},_setupHDragHandler:function(){var self=this;var _getMousePos=function(e){var offset=self._$hSpace.offset(),top=e.pageY-offset.top;return top};var _mouseMoveHandler=function(e){self._computeH(_getMousePos(e))};var _disableSelect=function(e){e.preventDefault()};var _mouseUpHandler=function(e){$(document.body).unbind("mousemove",_mouseMoveHandler).unbind("mouseup",_mouseUpHandler).unbind("mousedown",_disableSelect)};this._$hSpace.mousedown(function(e){self._computeH(_getMousePos(e));$(document.body).bind("mousemove",_mouseMoveHandler).bind("mouseup",_mouseUpHandler).bind("mousedown",_disableSelect)})},_computeSV:function(left,top){var saturation=left/this._svSize,value=(this._svSize-top)/this._svSize;this._s(saturation*100);this._v(value*100)},_computeH:function(top){this._h(top/this._hSize*360)},_setPickerPosition:function(){if(this._$svPicker){var hsv=this.hsv(),hue=hsv[0],saturation=hsv[1],value=hsv[2];this._$svPicker.css({left:Math.round(saturation/100*this._svSize)+"px",top:Math.round((100-value)/100*this._svSize)+"px"});this._$hPicker.css({top:Math.round(hue/360*this._hSize)+"px"})}},_apply:function(){if(this._recent().length>this._recentMax){this._recent.shift()}this._recent.push({rgbString:"rgb("+this.rgb().join(",")+")",hexString:this.hexString(),hex:this.hex()});this.trigger("apply",this.hex())},_cancel:function(){this.trigger("cancel")}});Widget.provideBinding("palette",Palette);return Palette});define("qpf",["require","core/xmlparser","core/mixin/derive","core/mixin/event","core/clazz","base","util","mixin/draggable","meta/meta","meta/button","meta/checkbox","meta/combobox","meta/label","meta/slider","meta/spinner","meta/textfield","container/container","container/panel","container/window","container/tab","container/vbox","container/hbox","container/inline","container/application","widget/widget","widget/vector","widget/palette"],function(require){var qpf={core:{XMLParser:require("core/xmlparser"),mixin:{derive:require("core/mixin/derive"),event:require("core/mixin/event")},Clazz:require("core/clazz")},Base:require("base"),util:require("util"),mixin:{Draggable:require("mixin/draggable")},meta:{Meta:require("meta/meta"),Button:require("meta/button"),Checkbox:require("meta/checkbox"),Combobox:require("meta/combobox"),Label:require("meta/label"),Slider:require("meta/slider"),Spinner:require("meta/spinner"),Textfield:require("meta/textfield")},container:{Container:require("container/container"),Panel:require("container/panel"),Window:require("container/window"),Tab:require("container/tab"),VBox:require("container/vbox"),HBox:require("container/hbox"),Inline:require("container/inline"),Application:require("container/application")},widget:{Widget:require("widget/widget"),Vector:require("widget/vector"),Palette:require("widget/palette")}};qpf.create=qpf.Base.create;return qpf});var qpf=require("qpf");_exports.use=function(path){return require(path)};for(var name in qpf){_exports[name]=qpf[name]}});